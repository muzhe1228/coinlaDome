(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-519d3ae4"],{"0fba":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAeCAMAAAAB8C7XAAAAY1BMVEUAAADkyXjkyXjkynjs0YTlyXf/6IbkyXflynnrzH7lynvjyHfkyHfkyXfkyHfkynfly3nmzHnozXjmzID//4DkyHjjyXfkyXflyHjkyXjjynfjynnkyXjly3nny3vjzXrjyHe+nWEKAAAAIHRSTlMA4Z9cDZkFtUAZE/bw0b98OzEhCgLMr6mRjnhuaE42Lp+Cy3YAAACLSURBVCjPdc1HDgJBEENRV6eZnpzIqe5/SkBiAbTrb59kw+gK2hYdWE2lHqRaVBcUZaeqUq6Mnb76v5hjq+9+LkJ9Ev3UBiCFvEz+7Hr96gBAWTcDumRAhAEPA/YwYDagggF3AyI4SDCgBocjOFSJw7CCwi6AwtCAwriBgUwAAbmsIND7hCJxPoP0BAn2LLsF8RwyAAAAAElFTkSuQmCC"},c3fa:function(e,t,s){"use strict";var a=s("c47c"),n=s.n(a);n.a},c47c:function(e,t,s){},cd99:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAeCAMAAAAB8C7XAAAAY1BMVEUAAACqqqqrq6urq6uysrK2trasrKysrKyqqqqwsLCqqqqrq6urq6uqqqqqqqqrq6urq6urq6urq6utra2urq6zs7Oqqqqqqqqrq6uqqqqrq6uqqqqsrKysrKyqqqqsrKyqqqpOjlwpAAAAIHRSTlMA4J9cDQVAMxkT9vDBuLKamZB8OyEK5NLRzKl4bmhOLiRG+PwAAACISURBVCjPdc1HDsMwEATBYSaVo3PY/7/ShCHAgszpax0aT5D0QMBIm4qwiJx8UZSI6FiaSK6eUmHyrerDAWwlW2r0di832XXWdzMv0boMLymVwdUEMDB4M0DHIDBAxyAwQM/AKgLwDDAycC0BrA0B2CsBpIYAMDHArAhgfWyEv5y5/OBQNFp9AFGYLL+aGuVPAAAAAElFTkSuQmCC"},da13:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrapper"},[a("div",{staticClass:"header"},[a("div",{staticClass:"leftBack",on:{click:e.BackHome}},[a("img",{attrs:{src:s("89b5"),alt:""}}),a("span",{staticClass:"backTitle"},[e._v("返回")])]),a("h1",[e._v("客服")])]),a("div",{staticClass:"mainPage"},[a("ScrollH",{attrs:{scrollToEndFlag:!0,data:e.dataArray}},e._l(e.dataArray,function(t){return a("div",{key:t.id,staticClass:"messageDiv"},["呼出"===t.calltype?a("div",{staticClass:"leftMessage-div"},[a("p",{staticClass:"l-headImg"},[a("img",{attrs:{src:e.ENV.ImageURL+"systemImg/kefu.png",alt:""}})]),a("p",{staticClass:"l-img"},[a("img",{attrs:{src:s("cd99"),alt:""}})]),a("div",{staticClass:"l-message copy"},[a("p",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.message,expression:"item.message",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onSuccess,expression:"onSuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.onError,expression:"onError",arg:"error"}]},[e._v("\n              "+e._s(t.message)+"\n              "),a("br"),a("span",{staticClass:"bottomTime"},[e._v(e._s(e.GetMessageTime(t.createtime)))])])])]):a("div",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.message,expression:"item.message",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onSuccess,expression:"onSuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.onError,expression:"onError",arg:"error"}],staticClass:"rightMessage-div"},[a("div",{staticClass:"r-message copy"},[a("span",[e._v("\n              "+e._s(t.message)+"\n              "),a("br"),a("span",{staticClass:"bottomTime"},[e._v(e._s(e.GetMessageTime(t.createtime)))])])]),a("p",{staticClass:"r-img"},[a("img",{attrs:{src:s("0fba"),alt:""}})]),a("p",{staticClass:"r-headImg"},[a("img",{attrs:{src:e.userInfo.head,alt:""}})])])])}),0)],1),a("div",{staticClass:"InputDiv"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.inputValue,expression:"inputValue"}],attrs:{placeholder:"请输入您的问题"},domProps:{value:e.inputValue},on:{keydown:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.SendMessage(t):null},input:[function(t){t.target.composing||(e.inputValue=t.target.value)},function(t){e.changeText(e.inputValue)}],focus:function(t){e.changeText(e.inputValue)}}}),a("span",{on:{click:e.SendMessage}},[e._v("发送")])])])},n=[],i=s("a34a"),r=s.n(i),c=s("7eb0"),o=s.n(c),u=s("752c"),l=s("2f62"),p=s("bc3a"),d=s.n(p),m=s("460c"),g=s("ad82");function A(e,t,s,a,n,i,r){try{var c=e[i](r),o=c.value}catch(u){return void s(u)}c.done?t(o):Promise.resolve(o).then(a,n)}function h(e){return function(){var t=this,s=arguments;return new Promise(function(a,n){var i=e.apply(t,s);function r(e){A(i,a,n,r,c,"next",e)}function c(e){A(i,a,n,r,c,"throw",e)}r(void 0)})}}function f(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{},a=Object.keys(s);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(s).filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable}))),a.forEach(function(t){v(e,t,s[t])})}return e}function v(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var y={data:function(){return{dataArray:[],inputValue:"",messageType:"",socket:null,appId:"1eftbf",socketData:null,ENV:m["a"].getENV(),canReceiveMessage:!0}},mounted:function(){this.GetHistory(),this.GetSocketData()},destroyed:function(){this.canReceiveMessage=!1,this.socket&&this.socket.onclose()},computed:f({},Object(l["d"])(["userInfo"])),components:{ScrollH:u["a"]},methods:{onSuccess:function(){this.$clickAudio(),this.$toast("复制成功")},onError:function(){this.$clickAudio(),this.$toast("复制失败，请点击重试")},changeText:function(e){this.$changeInput(e)},BackHome:function(){this.canReceiveMessage=!1,this.socket&&this.socket.onclose(),this.$clickAudio(),this.$router.push("/index")},GetSocketData:function(){var e=this;d.a.get(this.ENV.serveChatHttp+"/im/bbpk/"+this.appId+".html",{params:null}).then(function(t){e.socketData=t.data,e.CreateSocket()}).catch(function(e){})},CreateSocket:function(){this.socket=o()(this.ENV.serveChatWS+"/im/user?userid="+this.userInfo.userId+"&orgi=cskefu&session="+this.socketData.sessionid+"&appid="+this.appId+"&osname=&browser=&nickname="+this.userInfo.nick+"&title="+this.socketData.title+"&url=window.location.href&traceid="+this.socketData.traceid,{transports:["websocket","polling"]}),this.ReceiveMessage()},GetHistory:function(){var e=this;d.a.get(this.ENV.serveChatHttp+"/im/bbpk/history.html?appid="+this.appId+"&orgi=cskefu&userid="+this.userInfo.userId,{params:null}).then(function(t){console.log("历史消息",t.data),e.dataArray=t.data.reverse()}).catch(function(e){})},SendMessage:function(){var e=h(r.a.mark(function e(){return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.$sendMessage(),0!=this.inputValue.trim().length){e.next=4;break}return this.$toast("不能发送空白消息"),e.abrupt("return");case 4:return console.log(this.inputValue),{message:this.inputValue,calltype:"呼入"},e.next=8,this.socket.emit("message",{appid:this.appId,message:this.inputValue,orgi:"cskefu",session:this.socketData.sessionid,type:"message",userid:this.userInfo.userId});case 8:this.inputValue="";case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),ReceiveMessage:function(e){var t=this;this.socket.on("message",function(e){console.log("接收到socket消息",e),t.dataArray=t.dataArray.concat(e)}),this.socket.on("disconnect",function(){console.log("连接客服失败，在线咨询服务不可用")}),this.socket.on("connect",function(){console.log("socket连接中")}),this.socket.on("agentstatus",function(e){console.log(e.message),t.canReceiveMessage&&t.$toast(e.message,3e3)}),this.socket.on("status",function(e){console.log(e.message),t.canReceiveMessage&&t.$toast(e.message,3e3)})},GetMessageTime:function(e){var t=/\-+/g;e=e.replace(t,"/");var s=new Date(e).getTime(new Date(e)),a=Object(g["m"])(s,"hh");return a>=0&&a<13?Object(g["m"])(s,"MM/dd hh:mm")+" AM":Object(g["m"])(s,"MM/dd")+" "+(a-12)+Object(g["m"])(s,":mm")+" PM"}}},k=y,b=(s("c3fa"),s("2877")),q=Object(b["a"])(k,a,n,!1,null,"4924a981",null);q.options.__file="ServerChat.vue";t["default"]=q.exports}}]);
//# sourceMappingURL=chunk-519d3ae4.736606a7.js.map